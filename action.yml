name: 'Build and send diploma thesis'
description: 'GitHub action to build and send a diploma thesis using the corresponding docker image'
author: 'bitsneak'
branding:
  icon: 'upload-cloud'
  color: 'blue'

inputs:
  thesis-path:
    description: 'The path to the filled out diploma thesis folder. If not set it will default to Diplomarbeit'
    default: 'Diplomarbeit'
    required: false
  smtp-server:
    description: 'The smtp server of your sending email'
    required: true
  smtp-port:
    description: 'The smtp server port of your sending email'
    required: true
  mail-address:
    description: 'The sending email address'
    required: true
  mail-address-password:
    description: 'The password for the sending email address'
    required: true
  teams-mail:
    description: 'The email address of the teams channel the diploma thesis is sent to'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Pull docker image
      run: |
        docker pull bitsneak/htlle-da-env
        docker save bitsneak/htlle-da-env -o /tmp/.docker/image.tar
      shell: bash

    - name: Build diploma thesis
      run: docker run -v ${{ github.workspace }}/${{ inputs.thesis-path }}:/workspace bitsneak/htlle-da-env
      shell: bash

    - name: Send diploma thesis
      uses: dawidd6/action-send-mail@v4
      with:
        server_address: ${{ inputs.smtp-server }}
        server_port: ${{ inputs.smtp-port }}
        username: ${{ inputs.mail-address }}
        password: ${{ inputs.mail-address-password }}
        subject: "Diploma thesis"
        body: " "
        to: ${{ inputs.teams-mail }}
        from: ${{ inputs.mail-address }}
        attachments: Diplomarbeit/diplomarbeit.pdf
